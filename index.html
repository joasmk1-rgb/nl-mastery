<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>NL Mastery Platform</title>
    <style>
        :root { --primary: #1cb0f6; --success: #58cc02; --wrong: #ff4b4b; --bg: #f7f7f7; --text: #4b4b4b; --gold: #ffc800; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; color: var(--text); overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        
        /* Header & Stats */
        header { background: white; border-bottom: 2px solid #e5e5e5; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        .xp-badge { background: var(--gold); color: white; padding: 5px 12px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; }

        /* Navigation & Views */
        .view { display: none; flex-direction: column; align-items: center; padding: 20px; flex-grow: 1; overflow-y: auto; }
        .view.active { display: flex; }
        
        /* Dashboard Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 500px; margin-top: 20px; }
        .card-menu { background: white; padding: 20px; border-radius: 15px; border: 2px solid #e5e5e5; text-align: center; cursor: pointer; transition: transform 0.2s; font-weight: bold; }
        .card-menu:active { transform: scale(0.95); }
        .card-menu.blue { border-color: var(--primary); color: var(--primary); }

        /* Apprentissage */
        .study-box { width: 90%; max-width: 400px; background: white; border-radius: 25px; border: 2px solid #e5e5e5; padding: 30px; text-align: center; position: relative; box-shadow: 0 6px 0 #e5e5e5; }
        input { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #ccc; font-size: 1.1rem; margin: 15px 0; outline: none; text-align: center; }
        .btn { width: 100%; padding: 15px; border-radius: 15px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; color: white; }
        .btn-green { background: var(--success); box-shadow: 0 4px 0 #45a302; }
        .btn-gray { background: #e5e5e5; color: #afafaf; }

        /* Memory */
        .memory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
        .m-card { height: 80px; background: white; border: 2px solid #e5e5e5; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; text-align: center; cursor: pointer; }
        .m-card.selected { background: var(--primary); color: white; }
        .hidden { visibility: hidden; }

        .back-btn { align-self: flex-start; margin-bottom: 20px; background: none; border: none; color: var(--primary); font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <header>
        <div style="font-weight: bold; font-size: 1.2rem;">NL <span style="color:var(--primary)">Mastery</span></div>
        <div class="xp-badge">LVL <span id="lvl">1</span> ‚Ä¢ <span id="xp">0</span> XP</div>
    </header>

    <div id="home-view" class="view active">
        <h2>Que veux-tu bosser ?</h2>
        <div class="grid">
            <div class="card-menu blue" onclick="startSession('VERBENL')">Verbes</div>
            <div class="card-menu blue" onclick="startSession('NOMNL')">Noms</div>
            <div class="card-menu blue" onclick="startSession('ADJNL')">Adjectifs</div>
            <div class="card-menu blue" onclick="startSession('PHRASES_LABO')">Phrases Labo</div>
        </div>
        <h2 style="margin-top:40px;">Jeux & D√©fis</h2>
        <div class="grid">
            <div class="card-menu" style="color:var(--success)" onclick="startMemory()">üß© Memory</div>
            <div class="card-menu" style="color:var(--wrong)" onclick="startTimeAttack()">‚è±Ô∏è Contre-la-montre</div>
        </div>
    </div>

    <div id="study-view" class="view">
        <button class="back-btn" onclick="showHome()">‚Üê Retour</button>
        <div class="study-box">
            <small id="session-title"></small>
            <h1 id="q-text">Mots</h1>
            <input type="text" id="ans-input" placeholder="Traduire en N√©erlandais...">
            <div id="feedback" style="min-height: 20px; font-weight: bold; margin-bottom: 10px;"></div>
            <button class="btn btn-green" onclick="checkAns()">V√âRIFIER</button>
            <button class="btn btn-gray" onclick="nextQ()">PASSER</button>
        </div>
    </div>

    <div id="memory-view" class="view">
        <button class="back-btn" onclick="showHome()">‚Üê Retour</button>
        <div class="memory-grid" id="m-grid"></div>
    </div>

    <script>
        let fullDb = [];
        let sessionDb = [];
        let state = JSON.parse(localStorage.getItem('nl_platform_v1')) || { xp: 0, mastered: [] };
        let currentItem = null;

        async function init() {
            const files = ['VERBENL.csv', 'NOMNL.csv', 'ADJNL.csv', 'PHRASES_LABO.csv', 'MOTS_LABO.csv', 'THEME_BASE.csv'];
            for (let f of files) {
                try {
                    const r = await fetch(f);
                    const t = await r.text();
                    t.split(/\r?\n/).slice(1).forEach(l => {
                        const c = l.split(';');
                        if(c[1]) fullDb.push({ id: f+'_'+c[0], fr: c[1], nl: c[2].trim(), file: f.replace('.csv','') });
                    });
                } catch(e){}
            }
            updateStats();
        }

        function showHome() { 
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('home-view').classList.add('active');
        }

        function startSession(category) {
            sessionDb = fullDb.filter(i => i.file === category);
            if(sessionDb.length === 0) { alert("Fichier " + category + " vide ou manquant."); return; }
            document.getElementById('session-title').innerText = category;
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('study-view').classList.add('active');
            nextQ();
        }

        function nextQ() {
            currentItem = sessionDb[Math.floor(Math.random()*sessionDb.length)];
            document.getElementById('q-text').innerText = currentItem.fr;
            document.getElementById('ans-input').value = "";
            document.getElementById('feedback').innerText = "";
            document.getElementById('ans-input').focus();
        }

        function checkAns() {
            const user = document.getElementById('ans-input').value.toLowerCase().trim();
            const correct = currentItem.nl.toLowerCase().trim();
            if(user === correct) {
                document.getElementById('feedback').innerText = "‚úÖ BRAVO !";
                document.getElementById('feedback').style.color = "var(--success)";
                state.xp += 10;
                save();
                setTimeout(nextQ, 1000);
            } else {
                document.getElementById('feedback').innerText = "‚ùå R√âPONSE : " + currentItem.nl;
                document.getElementById('feedback').style.color = "var(--wrong)";
            }
        }

        // MEMORY GAME
        function startMemory() {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('memory-view').classList.add('active');
            const grid = document.getElementById('m-grid'); grid.innerHTML = "";
            let items = [...fullDb].sort(() => 0.5 - Math.random()).slice(0, 6);
            let cards = []; items.forEach(i => { cards.push({t:i.fr, id:i.id}, {t:i.nl, id:i.id}); });
            cards.sort(() => 0.5 - Math.random());
            
            let selected = [];
            cards.forEach(c => {
                let d = document.createElement('div'); d.className = 'm-card'; d.innerText = c.t;
                d.onclick = () => {
                    if(selected.length < 2 && !d.classList.contains('selected')) {
                        d.classList.add('selected'); selected.push({el:d, id:c.id});
                        if(selected.length === 2) {
                            if(selected[0].id === selected[1].id) {
                                setTimeout(() => { selected.forEach(s => s.el.classList.add('hidden')); selected = []; }, 600);
                                state.xp += 5; save();
                            } else {
                                setTimeout(() => { selected.forEach(s => s.el.classList.remove('selected')); selected = []; }, 800);
                            }
                        }
                    }
                };
                grid.appendChild(d);
            });
        }

        function save() { 
            localStorage.setItem('nl_platform_v1', JSON.stringify(state)); 
            updateStats(); 
        }

        function updateStats() {
            document.getElementById('xp').innerText = state.xp;
            document.getElementById('lvl').innerText = Math.floor(state.xp / 100) + 1;
        }

        // Touche Enter
        document.getElementById('ans-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkAns(); });

        init();
    </script>
</body>
</html>
